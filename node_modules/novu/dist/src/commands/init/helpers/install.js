"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.install = void 0;
const picocolors_1 = require("picocolors");
const cross_spawn_1 = __importDefault(require("cross-spawn"));
async function install(packageManager, isOnline) {
    const args = ['install'];
    if (!isOnline) {
        console.log((0, picocolors_1.yellow)('You appear to be offline.\nFalling back to the local cache.'));
        args.push('--offline');
    }
    return new Promise((resolve, reject) => {
        const child = (0, cross_spawn_1.default)(packageManager, args, {
            stdio: 'inherit',
            env: Object.assign(Object.assign({}, process.env), { ADBLOCK: '1', NODE_ENV: 'development', DISABLE_OPENCOLLECTIVE: '1' }),
        });
        child.on('close', (code) => {
            if (code !== 0) {
                reject({ command: `${packageManager} ${args.join(' ')}` });
                return;
            }
            resolve();
        });
    });
}
exports.install = install;
